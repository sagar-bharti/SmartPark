<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Park ‚Äì Live Booking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* CSS Wahi rahega jo aapne banaya tha */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: #f5f7fa; }
        header { background: #ffffff; padding: 15px 60px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 26px; font-weight: bold; color: #2ecc71; cursor: pointer; }
        nav a { margin: 0 15px; text-decoration: none; color: #444; font-weight: 500; }
        #home-1 { height: calc(100vh - 80px); background: linear-gradient(rgba(0,140,200,0.8), rgba(0,140,200,0.8)), url("https://images.unsplash.com/photo-1506521781263-d8422e82f27a") center/cover; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: #fff; }
        .booking-form { background: #ffffff; padding: 20px; border-radius: 8px; display: flex; gap: 15px; width: 80%; max-width: 900px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .booking-form input, .booking-form select { flex: 1; padding: 14px; border: 1px solid #ddd; border-radius: 5px; }
        .booking-form button { background: #2ecc71; color: white; border: none; padding: 14px 25px; font-weight: bold; border-radius: 5px; cursor: pointer; }
        #home-2 { display: none; padding: 50px 60px; background: #f5f7fa; min-height: 100vh; }
        .parking-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
        .parking-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 5px solid #2ecc71; transition: 0.3s; }
        .parking-card img { width: 100%; height: 200px; object-fit: cover; }
        .card-info { padding: 20px; }
        .price-tag { font-size: 22px; font-weight: bold; color: #2c3e50; margin: 10px 0; }
        .confirm-btn { display: block; width: 100%; text-align: center; background: #3498db; color: white; padding: 12px; text-decoration: none; border-radius: 5px; margin-top: 15px; cursor: pointer; border:none; }
        .confirm-btn:disabled { background: #ccc; cursor: not-allowed; }
    
        /* ===============================
   RESPONSIVE FIX (MOBILE + TAB)
================================*/

        /* Header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:15px 30px;
  background:#ffffff;
}
        .logo img{
  height:20px;      /* size adjust */
  cursor:pointer;
}

nav a{
  margin-left:20px;
  text-decoration:none;
  color:#333;
  font-weight:600;
}

nav a:hover{
  color:#0b5ed7;
}


/* Tablet */
@media (max-width: 992px) {
    header {
        padding: 12px 30px;
    }

    nav a {
        margin: 0 8px;
        font-size: 14px;
    }

    #home-1 h1 {
        font-size: 36px;
    }

    .booking-form {
        width: 90%;
    }
}

/* Mobile */
@media (max-width: 768px) {
    header {
        flex-wrap: wrap;
        padding: 12px 20px;
        text-align: center;
    }

    nav {
        width: 100%;
        margin-top: 10px;
    }

    nav a {
        display: inline-block;
        margin: 5px 8px;
    }

    .phone {
        width: 100%;
        margin-top: 8px;
        font-size: 14px;
    }

    #home-1 {
        padding: 20px;
        height: auto;
        min-height: 100vh;
    }

    #home-1 h1 {
        font-size: 28px;
        line-height: 1.2;
    }

    #home-1 p {
        font-size: 15px;
        margin: 10px 0 20px;
    }

    .booking-form {
        flex-direction: column;   /* üîë MAIN FIX */
        width: 100%;
        gap: 12px;
    }

    .booking-form input,
    .booking-form select,
    .booking-form button {
        width: 100%;
        font-size: 15px;
    }
}

/* Small Mobile */
@media (max-width: 480px) {
    #home-1 h1 {
        font-size: 24px;
    }

    .logo {
        font-size: 22px;
    }
}

    
    </style>
</head>
<body>

     <header class="header">
  <a href="index.html" class="logo">
    <img src="logo.png" alt="Smart Park Logo">
  </a>

  <nav>
    <a href="index.html">Home</a>
    <a href="features.html">Features</a>
    <a href="about.html">About Us</a>
  </nav>
</header>
         <div class="profile-dropdown" style="position: relative;">
            <div class="profile-circle" onclick="toggleMenu()" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid #2ecc71; cursor: pointer; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User" style="width: 100%; height: 100%; object-fit: cover;">
            </div>

            <div id="menu" style="display: none; position: absolute; right: 0; top: 50px; width: 200px; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border-radius: 8px; flex-direction: column; padding: 10px; z-index: 2000;">
                <div style="padding: 10px; text-align: center;">
                    <strong id="user-name">Loading...</strong>
                    <div id="user-role" style="font-size: 10px; color: #2ecc71;"></div>
                </div>
                <hr style="border: 0.5px solid #eee;">
                <a href="dashboard.html" style="padding: 10px; text-decoration: none; color: #333;">üè† Dashboard</a>
                <div id="owner-links-nav" style="display:none;">
                    <a href="ownerdashboard.html" style="padding: 10px; text-decoration: none; color: #333; display: block;">üÖøÔ∏è My Parkings</a>
                </div>
                <a href="#" onclick="logout()" style="padding: 10px; text-decoration: none; color: red;">üö™ Logout</a>
            </div>
    </header>

    <div id="main-content">
        <section id="home-1">
            <h1>Best Deals For Parking!</h1>
            <p>Book your spot in seconds and save money.</p>
            <form class="booking-form" id="bookingForm">
                <select id="loc" required>
                    <option value="">Select Location</option>
                    <option value="Nearby">Nearby</option>
                </select>
                <input type="text" placeholder="Name" required>
                <input type="tel" placeholder="Mobile" required>
                <button type="submit">Search Parking</button>
            </form>
        </section>
    </div>

    <section id="home-2">
        <h2 style="text-align:center;">Available Parking Spaces</h2>
        <p id="location-display" style="text-align:center; color:#666;"></p>

        <div class="parking-grid" id="parking-grid">
            </div>
    </section>

    <script type="module">
    // 1. Imports mein onSnapshot add kiya gaya hai
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCRK6QnA0F_MNkSdNiVnNgypt2TzlaVomQ",
        authDomain: "smart-parking-3d52f.firebaseapp.com",
        projectId: "smart-parking-3d52f",
        storageBucket: "smart-parking-3d52f.firebasestorage.app",
        messagingSenderId: "139926831182",
        appId: "1:139926831182:web:14ce31ebdaa2b5acac431f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const bookingForm = document.getElementById('bookingForm');
    const mainContent = document.getElementById('main-content');
    const home2 = document.getElementById('home-2');
    const grid = document.getElementById('parking-grid');

    // --- 2. Doori nikalne ka function (Distance Calculation) ---
    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // Earth's radius in km
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return (R * c).toFixed(1); 
    }

    // --- 3. Updated Real-time Load Function ---
    async function loadParkingData() {
        grid.innerHTML = "<h3 style='grid-column: 1/-1; text-align:center;'>Finding Nearby Parking...</h3>";
        
        // User ki GPS location mangna
        navigator.geolocation.getCurrentPosition((position) => {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;

            // Real-time listener: Jab bhi Firebase mein data badlega, ye apne aap update hoga
            const q = collection(db, "parking_spots");
            onSnapshot(q, (snapshot) => {
                grid.innerHTML = ""; 

                snapshot.forEach((docSnap) => {
                    const spot = docSnap.data();
                    const id = docSnap.id;
                    
                    // Distance calculate karein
                    const distance = calculateDistance(userLat, userLng, spot.lat, spot.lng);

                    grid.innerHTML += `
                        <div class="parking-card">
                            <img src="${spot.image || 'https://via.placeholder.com/300x200'}" alt="parking">
                            <div class="card-info">
                                <h3>${spot.name}</h3>
                                <p style="color:#666; font-size:14px;">üìç ${distance} km away</p>
                                <p style="color:${spot.available > 0 ? '#2ecc71' : '#e74c3c'}; font-weight:bold; margin-top:5px;">
                                    Available: ${spot.available} Slots
                                </p>
                                <div class="price-tag">${spot.price === "Free" || spot.price == 0 ? 'Free' : '‚Çπ' + spot.price + '/hr'}</div>
                                
                                <a href="https://www.google.com/maps/dir/?api=1&destination=${spot.lat},${spot.lng}" 
                                   target="_blank" class="confirm-btn" style="background:#3498db; text-decoration:none; margin-bottom:8px;">
                                   üß≠ Start Navigation
                                </a>

                                <button onclick="window.confirmBooking('${id}')" class="confirm-btn" ${spot.available <= 0 ? 'disabled' : ''}>
                                    ${spot.available > 0 ? 'Book Now' : 'Full'}
                                </button>
                            </div>
                        </div>
                    `;
                });
            }, (error) => {
                grid.innerHTML = "<p>Error: " + error.message + "</p>";
            });
        }, (err) => {
            alert("Please enable GPS location to see nearby parking.");
        });
    }

    // 4. Booking Logic: Ab ye redirect karega naye page par
    window.confirmBooking = (id) => {
        window.location.href = `booking-details.html?spotId=${id}`;
    };

    bookingForm.addEventListener('submit', function(e) {
        e.preventDefault();
        mainContent.style.display = 'none';
        home2.style.display = 'block';
        window.scrollTo(0, 0);
        loadParkingData();
    });
</script>
</body>
</html>
